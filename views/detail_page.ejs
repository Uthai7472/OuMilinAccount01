<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      .month-topic {
        width: 100%;
        height: auto;
        padding: 10px;
        border: 1px solid black;
        display: flex;
        justify-content: center;
        margin: 1rem;
        min-width: 50rem;
      }
      .note-container {
        width: 100%;
        height: auto;
        border: 1px solid black;
        margin: 1rem;
        padding: 1rem;
        min-width: 50rem;
      }
      .textarea {
        width: 90%;
        height: 65%;
        min-width: 90%;
        /* border: 1px solid purple; */
      }
      textarea {
        width: 100%;
        height: 100%;
        border-radius: 5px;
        border: 3px solid rgb(149, 125, 173);
        background-color: rgb(149, 125, 173);
        padding: 5px;
        color: rgb(254, 200, 216);
      }

      .table-header {
        width: 100%;
        height: auto;
        border: 1px solid black;
        margin: 1rem 1rem 0 1rem;
        padding: 10px;
        display: flex;
        justify-content: space-between;
        min-width: 50rem;
      }
      .col-1 {
        width: 10rem;
        height: auto;
        
        /* border: 1px solid red; */
        display: flex;
        justify-content: center;
      }
      .col-2 {
        width: 10rem;
        height: auto;
        /* border: 1px solid red; */
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .col-3 {
        width: 15rem;
        height: auto;
        /* border: 1px solid red; */
        display: flex;
        justify-content: center;
      }
      .col-4 {
        width: 5rem;
        height: auto;
        /* border: 1px solid red; */
        display: flex;
        justify-content: center;
      }
      .col-5 {
        width: 10rem;
        height: auto;
        /* border: 1px solid red; */
        display: flex;
        justify-content: center;
      }

      .table-input {
        width: 100%;
        height: 4rem;
        border: 1px solid black;
        margin: 0 1rem 0 1rem;
        padding: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        min-width: 50rem;
      }
      .table-input .col-1 {
        width: 10rem;
        /* margin-left: 5px; */
        /* border: 1px solid red; */
        margin: 0;
      }
      .table-input .col-2 {
        width: 10rem;
        height: 1.8rem;
        /* border: 1px solid red; */
        padding: 0 10px 0 10px;
        margin: 0;
        transform: translateX(-5px);
      }
      .table-input .col-3 {
        width: 15rem;
        height: 1.8rem;
        /* border: 1px solid red; */
        padding-left: 10px;
        padding-right: 10px;
        transform: translateX(-6px);
      }
      .table-input .col-4 {
        width: 5rem;
        /* margin-left: 5px; */
        height: 1.8rem;
        /* border: 1px solid red; */
        padding-left: 10px;
        padding-right: 10px;
        transform: translateX(-20px);
      }
      .table-input .col-5 {
        width: 8rem;
        /* margin-left: 5px; */
        /* height: 1.8rem; */
        /* border: 1px solid red; */
        /* padding-left: 10px; */
        transform: translateX(-2rem);
        padding-left: 10px;
        padding-right: 10px;
      }
      .table-input .btn.btn-primary {
        width: 100%;
        height: 100%;
        /* height: 3rem; */
        font-size: 14px;
        /* margin-bottom: 10px; */
        /* margin-bottom: 10px; */
      }
      input[type="date"], input[type="text"], input[type="number"] {
        width: 100%;
        padding-left: 10px;
        padding-right: 10px;
        border-radius: 5px;
      }
      select {
        width: 100%;
        height: 100%;
        background-color: rgb(254, 200, 216);
        border-radius: 5px;
        padding-left: 10px;
        padding-right: 10px;
      }
      input[type="text"] {
        width: 100%;
      }

      .table-sum {
        width: 100%;
        height: auto;
        border: 1px solid black;
        margin: 0 1rem 0 1rem;
        padding: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        min-width: 50rem;
      }

      .table-history {
        width: 100%;
        height: auto;
        border: 1px solid black;
        margin: 0 1rem 0 1rem;
        padding: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        min-width: 50rem;
      }

      @media screen and (max-width: 500px) {
        h5 {
          font-size: 16px;
        }
        h4 {
          font-size: 18px;
        }

        .month-topic {
          justify-content: flex-start;

        }

        textarea {
          width: 100%;
          /* height: 65%; */
          /* border: 1px solid red; */
          /* margin: auto 0; */
          /* min-width: 600px; */
        }

        .note-container, .btn.btn-primary {
          font-size: 12px;
        }

        .table-input .col-4 {
          transform: translateX(-6px);
        }
        .table-input .col-5 {
          transform: translateX(0.4rem);
          
        }
        
      }

      @media screen and (max-width: 825px) {
        .table-input .col-4 {
          transform: translateX(-6px);
        }
        .table-input .col-5 {
          transform: translateX(0.4rem);
          
        }
      }
    </style>
</head>
<body>
    
    <%- include('subview/header') %>

    <div class="month-topic">
      <h2>เดือน <%= month_name %></h2>
    </div>

    <form action="/data_page/detail/save_note" method="POST">
      <div class="note-container">
        <div class="note-topic">
          <h4>Note :</h4>
        </div>
        <div>
          <input type="text" name="month" id="month" value="<%= month_name %>" hidden>
        </div>
        <div class="textarea">
          <textarea name="note" id="note" readonly><%= get_note[0].note %></textarea>
        </div>
        <div class="remark-action">
          <button type="submit" class="btn btn-success">บันทึก</button>
          <button type="button" class="btn btn-warning edit">เเก้ไข</button>
        </div>
      </div>
    </form>

    <div class="table-header">
      <div class="col-1">
        <h5>วันที่</h5>
      </div>
      <div class="col-2">
        <h5>หมวดหมู่</h5>
      </div>
      <div class="col-3">
        <h5>รายการ</h5>
      </div>
      <div class="col-4">
        <h5>ราคา</h5>
      </div>
      <div class="col-5">
        <h5>Action</h5>
      </div>
    </div>

    <form action="/data_page/detail/add" method="POST">
      <div class="table-input">
        <input type="text" name="month" id="month" value="<%= month_name %>" hidden>
        <textarea name="note" id="note" hidden><%= get_note[0].note %></textarea>
        <div class="col-1">
          <input type="date" name="date" id="date" required>
        </div>
        <div class="col-2">
          <select name="category" id="category">
            <option value="สำคัญ">สำคัญ</option>
            <option value="ของกินเล่น">ของกินเล่น</option>
            <option value="ของใช้ในบ้าน">ของใช้ในบ้าน</option>
            <option value="ทำกินเอง">ทำกินเอง</option>
          </select>
        </div>
        <div class="col-3">
          <input type="text" name="detail" id="detail" required>
        </div>
        <div class="col-4">
          <input type="number" name="price" id="price" required>
        </div>
        <div class="col-5">
          <button type="submit" class="btn btn-primary">เพิ่มรายจ่าย</button>
        </div>
      </div>
    </form>

    <div class="table-sum">
      <div class="col-1">
        <h5>รวมทั้งหมด</h5>
      </div>
      <div class="col-2">
        
      </div>
      <div class="col-3">
        
      </div>
      <div class="col-4">
        <h5><%= get_sum[0].sumPrice ? get_sum[0].sumPrice : '0' %></h5>
      </div>
      <div class="col-5">
        บาท
      </div>
    </div>

    
      <% get_history.forEach((row) => { %> 
        <% if (row.date) { %>
        <div class="table-history">
          <div class="col-1">
            <h5><%= row.date ? row.date.toLocaleDateString('en-GB') : '' %></h5>
          </div>
          <div class="col-2">
            <h5><%= row.category %></h5>
          </div>
          <div class="col-3">
            <h5><%= row.detail %></h5>
          </div>
          <div class="col-4">
            <h5><%= row.price %></h5>
          </div>
          <div class="col-5">
            <a href="" class="btn btn-warning">เเก้ไข</a>
            <a href="/data_page/detail/delete?id=<%= row.id %>&month=<%= row.month %>" class="btn btn-danger">ลบ</a>
          </div>
        </div>
        <% } %>
      <% }) %>
    

    <script>
      const editButton = document.querySelector('.edit');
      const noteTextarea = document.getElementById('note');
    
      editButton.addEventListener('click', function() {
        noteTextarea.readOnly = !noteTextarea.readOnly;
        noteTextarea.focus();
      });
    </script>

</body>
</html>